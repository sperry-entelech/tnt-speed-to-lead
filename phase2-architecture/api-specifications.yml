openapi: 3.0.3
info:
  title: TNT Corporate Lead Automation System API
  description: |
    RESTful API for TNT Limousine's corporate lead capture, scoring, and automation system.

    **Business Goals:**
    - Reduce lead response time from 48-72 hours to <5 minutes
    - Automate corporate lead qualification and scoring
    - Integrate with FastTrack InVision, Zoho CRM, and richweb.net SMTP
    - Track $15K+ monthly revenue recovery through improved conversion rates

    **Key Features:**
    - Real-time lead capture with automatic scoring algorithm
    - Automated email response system with TNT branding
    - Manager notifications for high-value leads (>$1,000)
    - Competitive analysis and ROI calculator integration
    - Comprehensive analytics and performance tracking
  version: 2.0.0
  contact:
    name: TNT Limousine System Admin
    email: admin@tntlimousine.com
  license:
    name: Proprietary
    url: https://github.com/sperry-entelech/tnt-corporate-lead-system

servers:
  - url: https://api.tntleads.com/v2
    description: Production server
  - url: https://staging-api.tntleads.com/v2
    description: Staging server
  - url: http://localhost:3001/api/v2
    description: Development server

security:
  - BearerAuth: []
  - ApiKeyAuth: []

paths:
  # =====================================================
  # LEAD MANAGEMENT ENDPOINTS
  # =====================================================

  /leads:
    post:
      summary: Create new lead from website form
      description: |
        Primary endpoint for capturing leads from TNT website forms.
        Automatically triggers:
        - Lead scoring algorithm execution
        - Automated email response (if configured)
        - High-value lead notifications (if >$1,000 estimated value)
        - CRM integration sync
        - Manager/dispatcher notifications
      tags: [Lead Management]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeadCreateRequest'
            examples:
              corporate_booking:
                summary: Corporate airport transfer
                value:
                  company_name: "Richmond Financial Group"
                  contact_name: "Sarah Johnson"
                  email: "s.johnson@richmondfinancial.com"
                  phone: "+1-804-555-0123"
                  service_type: "corporate"
                  service_date: "2024-03-15T14:30:00Z"
                  pickup_location: "1401 E Broad St, Richmond, VA 23219"
                  destination: "Richmond International Airport (RIC)"
                  passenger_count: 3
                  estimated_value: 1200.00
                  custom_fields:
                    return_trip: true
                    billing_account: "CORP-001"
                    special_instructions: "Flight arrives at 3:45 PM"
              wedding_inquiry:
                summary: Wedding transportation
                value:
                  company_name: ""
                  contact_name: "Michael and Jennifer Davis"
                  email: "mjdavis.wedding@gmail.com"
                  phone: "+1-804-555-0156"
                  service_type: "wedding"
                  service_date: "2024-06-20T16:00:00Z"
                  pickup_location: "The Jefferson Hotel, Richmond, VA"
                  destination: "Maymont Park, Richmond, VA"
                  passenger_count: 6
                  estimated_value: 800.00
      responses:
        '201':
          description: Lead created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadCreateResponse'
              examples:
                high_value_corporate:
                  summary: High-value corporate lead created
                  value:
                    lead_id: "550e8400-e29b-41d4-a716-446655440000"
                    status: "new"
                    lead_score: 85
                    priority_level: 5
                    automated_response_sent: true
                    manager_notified: true
                    estimated_response_time: "3-5 minutes"
                    next_actions:
                      - "Automated email sent to customer"
                      - "High-value notification sent to manager"
                      - "CRM lead creation scheduled"
        '400':
          $ref: '#/components/responses/BadRequest'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: Retrieve leads with filtering and pagination
      description: Get leads for dashboard display with comprehensive filtering options
      tags: [Lead Management]
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [new, contacted, qualified, converted, lost]
          description: Filter by lead status
        - name: service_type
          in: query
          schema:
            type: string
            enum: [corporate, airport, wedding, hourly, events]
          description: Filter by service type
        - name: lead_score_min
          in: query
          schema:
            type: integer
            minimum: 0
            maximum: 100
          description: Minimum lead score threshold
        - name: date_from
          in: query
          schema:
            type: string
            format: date
          description: Start date for date range filter (YYYY-MM-DD)
        - name: date_to
          in: query
          schema:
            type: string
            format: date
          description: End date for date range filter (YYYY-MM-DD)
        - name: search
          in: query
          schema:
            type: string
            maxLength: 255
          description: Full-text search across company name, contact name, and email
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          description: Number of results per page
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [created_at, lead_score, estimated_value, status]
            default: created_at
          description: Field to sort by
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
      responses:
        '200':
          description: Leads retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /leads/{leadId}:
    get:
      summary: Get detailed lead information
      description: Retrieve comprehensive lead details including interaction history
      tags: [Lead Management]
      parameters:
        - name: leadId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique lead identifier
      responses:
        '200':
          description: Lead details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: Update lead information and status
      description: |
        Update lead details, status, or add manual notes.
        Triggers:
        - Status change notifications
        - CRM sync update
        - Workflow state changes
      tags: [Lead Management]
      parameters:
        - name: leadId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeadUpdateRequest'
      responses:
        '200':
          description: Lead updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadDetailResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /leads/{leadId}/interactions:
    post:
      summary: Record manual interaction with lead
      description: Add manual interaction (call, meeting, manual email) to lead history
      tags: [Lead Management]
      parameters:
        - name: leadId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InteractionCreateRequest'
      responses:
        '201':
          description: Interaction recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InteractionResponse'

    get:
      summary: Get interaction history for lead
      description: Retrieve complete interaction timeline for a specific lead
      tags: [Lead Management]
      parameters:
        - name: leadId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: type
          in: query
          schema:
            type: string
            enum: [email_sent, email_opened, email_clicked, call_made, meeting_scheduled, sms_sent]
          description: Filter by interaction type
      responses:
        '200':
          description: Interaction history retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InteractionResponse'

  # =====================================================
  # AUTOMATION ENDPOINTS
  # =====================================================

  /automation/trigger:
    post:
      summary: Manually trigger automation workflow
      description: |
        Manually trigger specific automation workflows for testing or special cases.
        Useful for:
        - Testing email templates
        - Sending follow-up sequences
        - Re-running failed automations
      tags: [Automation]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutomationTriggerRequest'
      responses:
        '200':
          description: Automation triggered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutomationTriggerResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /automation/templates:
    get:
      summary: Get email templates for automation
      description: Retrieve all active email templates with performance metrics
      tags: [Automation]
      parameters:
        - name: active_only
          in: query
          schema:
            type: boolean
            default: true
          description: Return only active templates
      responses:
        '200':
          description: Templates retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EmailTemplate'

    post:
      summary: Create new email template
      description: Create new automated email template with trigger conditions
      tags: [Automation]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailTemplateCreateRequest'
      responses:
        '201':
          description: Template created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailTemplate'

  /automation/performance:
    get:
      summary: Get automation performance metrics
      description: |
        Retrieve comprehensive automation performance data including:
        - Response time analytics
        - Email engagement rates
        - Conversion funnel metrics
        - A/B testing results
      tags: [Automation]
      parameters:
        - name: date_from
          in: query
          schema:
            type: string
            format: date
          description: Start date for metrics (default: 30 days ago)
        - name: date_to
          in: query
          schema:
            type: string
            format: date
          description: End date for metrics (default: today)
        - name: granularity
          in: query
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
          description: Time granularity for aggregated metrics
      responses:
        '200':
          description: Performance metrics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutomationPerformanceResponse'

  # =====================================================
  # ANALYTICS & REPORTING ENDPOINTS
  # =====================================================

  /analytics/dashboard:
    get:
      summary: Get dashboard summary metrics
      description: |
        Main dashboard KPIs including:
        - Daily/weekly/monthly lead counts
        - Conversion rates and revenue
        - Response time performance
        - Top performing sources
      tags: [Analytics]
      responses:
        '200':
          description: Dashboard metrics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardMetrics'

  /analytics/conversion-funnel:
    get:
      summary: Get conversion funnel analysis
      description: Detailed conversion funnel showing lead progression through stages
      tags: [Analytics]
      parameters:
        - name: date_range
          in: query
          schema:
            type: string
            enum: [7d, 30d, 90d, 1y]
            default: 30d
          description: Date range for analysis
        - name: segment_by
          in: query
          schema:
            type: string
            enum: [service_type, source, lead_score_tier]
          description: Segment funnel by specific dimension
      responses:
        '200':
          description: Conversion funnel data retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversionFunnelResponse'

  /analytics/response-times:
    get:
      summary: Get response time analytics
      description: |
        Analyze response time performance against TNT's 5-minute target:
        - Average response times by day/hour
        - Percentage of leads responded to under 5 minutes
        - Weekend/holiday performance
        - Staff performance comparison
      tags: [Analytics]
      parameters:
        - name: date_range
          in: query
          schema:
            type: string
            enum: [7d, 30d, 90d]
            default: 30d
      responses:
        '200':
          description: Response time analytics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseTimeAnalytics'

  /analytics/revenue-pipeline:
    get:
      summary: Get revenue pipeline analysis
      description: |
        Revenue tracking and forecasting:
        - Current pipeline value by stage
        - Monthly revenue trends
        - Average deal sizes
        - Service type revenue breakdown
      tags: [Analytics]
      responses:
        '200':
          description: Revenue pipeline data retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RevenuePipelineResponse'

  # =====================================================
  # INTEGRATION ENDPOINTS
  # =====================================================

  /integrations/status:
    get:
      summary: Get integration health status
      description: Check connection status and sync health for all external integrations
      tags: [Integrations]
      responses:
        '200':
          description: Integration status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IntegrationStatusResponse'

  /integrations/sync:
    post:
      summary: Manually trigger integration sync
      description: Force synchronization with external systems (Zoho CRM, FastTrack)
      tags: [Integrations]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationSyncRequest'
      responses:
        '200':
          description: Sync triggered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IntegrationSyncResponse'

  # =====================================================
  # WEBHOOK ENDPOINTS
  # =====================================================

  /webhooks/form-submission:
    post:
      summary: Handle website form submissions
      description: |
        Primary webhook endpoint for website form submissions.
        Processing pipeline:
        1. Validate and sanitize input data
        2. Execute lead scoring algorithm
        3. Select and send automated response
        4. Generate high-value lead notifications
        5. Queue CRM integration sync
        6. Log all activities for audit trail
      tags: [Webhooks]
      security: []  # Public endpoint with webhook signature validation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookFormSubmission'
      responses:
        '200':
          description: Form submission processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookProcessingResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /webhooks/email-engagement:
    post:
      summary: Track email engagement events
      description: Handle email opens, clicks, bounces, and replies from richweb.net SMTP
      tags: [Webhooks]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailEngagementWebhook'
      responses:
        '200':
          description: Email engagement tracked
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "processed"

  /webhooks/crm-updates:
    post:
      summary: Handle bidirectional CRM updates
      description: Sync updates from Zoho CRM back to TNT lead system
      tags: [Webhooks]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CRMUpdateWebhook'
      responses:
        '200':
          description: CRM update processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "synced"

# =====================================================
# COMPONENT SCHEMAS
# =====================================================

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    # Lead Management Schemas
    LeadCreateRequest:
      type: object
      required: [contact_name, email, service_type]
      properties:
        company_name:
          type: string
          maxLength: 255
          description: Company name (if corporate booking)
        contact_name:
          type: string
          maxLength: 255
          description: Primary contact person
        email:
          type: string
          format: email
          maxLength: 255
          description: Contact email address
        phone:
          type: string
          maxLength: 50
          pattern: '^\+?[1-9]\d{1,14}$'
          description: Contact phone number (E.164 format preferred)
        website:
          type: string
          format: uri
          maxLength: 255
          description: Company website URL
        service_type:
          type: string
          enum: [corporate, airport, wedding, hourly, events]
          description: Type of service requested
        service_date:
          type: string
          format: date-time
          description: Requested service date and time
        pickup_location:
          type: string
          maxLength: 500
          description: Pickup address or location
        destination:
          type: string
          maxLength: 500
          description: Destination address or location
        passenger_count:
          type: integer
          minimum: 1
          maximum: 50
          description: Number of passengers
        vehicle_preference:
          type: string
          maxLength: 100
          description: Preferred vehicle type or special requirements
        estimated_value:
          type: number
          format: decimal
          minimum: 0
          maximum: 99999.99
          description: Estimated booking value in USD
        source:
          type: string
          maxLength: 100
          default: "website"
          description: Lead source attribution
        utm_source:
          type: string
          maxLength: 100
          description: UTM source parameter
        utm_medium:
          type: string
          maxLength: 100
          description: UTM medium parameter
        utm_campaign:
          type: string
          maxLength: 100
          description: UTM campaign parameter
        custom_fields:
          type: object
          description: Additional custom form fields
          additionalProperties: true

    LeadCreateResponse:
      type: object
      properties:
        lead_id:
          type: string
          format: uuid
          description: Unique identifier for the created lead
        status:
          type: string
          enum: [new, contacted, qualified, converted, lost]
          description: Current lead status
        lead_score:
          type: integer
          minimum: 0
          maximum: 100
          description: Calculated lead score
        priority_level:
          type: integer
          minimum: 1
          maximum: 5
          description: Priority level (5 = highest priority)
        automated_response_sent:
          type: boolean
          description: Whether automated email response was sent
        manager_notified:
          type: boolean
          description: Whether manager was notified for high-value lead
        estimated_response_time:
          type: string
          example: "3-5 minutes"
          description: Expected response time commitment
        next_actions:
          type: array
          items:
            type: string
          description: List of automated actions taken or scheduled

    LeadUpdateRequest:
      type: object
      properties:
        status:
          type: string
          enum: [new, contacted, qualified, converted, lost]
        estimated_value:
          type: number
          format: decimal
        notes:
          type: string
          maxLength: 2000
          description: Internal notes about the lead
        converted_revenue:
          type: number
          format: decimal
          description: Actual converted revenue (if status = converted)
        lost_reason:
          type: string
          maxLength: 255
          description: Reason for loss (if status = lost)

    LeadDetailResponse:
      allOf:
        - $ref: '#/components/schemas/LeadCreateRequest'
        - type: object
          properties:
            lead_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [new, contacted, qualified, converted, lost]
            lead_score:
              type: integer
            priority_level:
              type: integer
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time
            last_contact_at:
              type: string
              format: date-time
            interactions:
              type: array
              items:
                $ref: '#/components/schemas/InteractionResponse'
            scoring_breakdown:
              type: object
              description: Detailed breakdown of lead score calculation
              properties:
                company_name_score:
                  type: integer
                value_tier_score:
                  type: integer
                service_type_score:
                  type: integer
                geographic_score:
                  type: integer
                timing_score:
                  type: integer

    LeadListResponse:
      type: object
      properties:
        leads:
          type: array
          items:
            $ref: '#/components/schemas/LeadSummary'
        pagination:
          $ref: '#/components/schemas/PaginationInfo'
        filters_applied:
          type: object
          description: Summary of applied filters
        total_count:
          type: integer
          description: Total number of leads matching filters

    LeadSummary:
      type: object
      properties:
        lead_id:
          type: string
          format: uuid
        company_name:
          type: string
        contact_name:
          type: string
        email:
          type: string
        service_type:
          type: string
        estimated_value:
          type: number
        lead_score:
          type: integer
        status:
          type: string
        created_at:
          type: string
          format: date-time
        minutes_since_created:
          type: number
          description: Minutes elapsed since lead creation
        last_interaction_type:
          type: string
          description: Most recent interaction type

    # Interaction Schemas
    InteractionCreateRequest:
      type: object
      required: [interaction_type, content]
      properties:
        interaction_type:
          type: string
          enum: [email_sent, call_made, meeting_scheduled, sms_sent]
        subject:
          type: string
          maxLength: 255
        content:
          type: string
          maxLength: 2000
        scheduled_for:
          type: string
          format: date-time
          description: For future scheduled interactions

    InteractionResponse:
      type: object
      properties:
        interaction_id:
          type: string
          format: uuid
        interaction_type:
          type: string
        subject:
          type: string
        content:
          type: string
        automated:
          type: boolean
        created_at:
          type: string
          format: date-time
        email_opened_at:
          type: string
          format: date-time
        email_clicked_at:
          type: string
          format: date-time
        response_received:
          type: boolean

    # Automation Schemas
    AutomationTriggerRequest:
      type: object
      required: [lead_id, workflow_type]
      properties:
        lead_id:
          type: string
          format: uuid
        workflow_type:
          type: string
          enum: [instant_response, follow_up_sequence, manager_notification]
        template_override:
          type: string
          description: Override default template selection
        delay_minutes:
          type: integer
          minimum: 0
          description: Delay before execution (for testing)

    AutomationTriggerResponse:
      type: object
      properties:
        trigger_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, processing, completed, failed]
        estimated_execution_time:
          type: string
          format: date-time
        actions_scheduled:
          type: array
          items:
            type: string

    EmailTemplate:
      type: object
      properties:
        template_id:
          type: string
          format: uuid
        template_name:
          type: string
        subject_line:
          type: string
        content:
          type: string
        trigger_conditions:
          type: object
        active:
          type: boolean
        performance_metrics:
          type: object
          properties:
            sent_count:
              type: integer
            open_rate:
              type: number
              format: percentage
            click_rate:
              type: number
              format: percentage
            response_rate:
              type: number
              format: percentage

    EmailTemplateCreateRequest:
      type: object
      required: [template_name, subject_line, content, trigger_conditions]
      properties:
        template_name:
          type: string
          maxLength: 100
        subject_line:
          type: string
          maxLength: 255
        content:
          type: string
          maxLength: 10000
        html_content:
          type: string
          maxLength: 20000
        trigger_conditions:
          type: object
          description: JSON object defining trigger conditions
        service_types:
          type: array
          items:
            type: string
            enum: [corporate, airport, wedding, hourly, events]
        active:
          type: boolean
          default: true

    # Analytics Schemas
    DashboardMetrics:
      type: object
      properties:
        time_period:
          type: object
          properties:
            today:
              $ref: '#/components/schemas/PeriodMetrics'
            this_week:
              $ref: '#/components/schemas/PeriodMetrics'
            this_month:
              $ref: '#/components/schemas/PeriodMetrics'
        response_time_performance:
          type: object
          properties:
            average_response_minutes:
              type: number
            under_5_minutes_rate:
              type: number
              format: percentage
            weekend_coverage_rate:
              type: number
              format: percentage
        top_performing_sources:
          type: array
          items:
            type: object
            properties:
              source:
                type: string
              lead_count:
                type: integer
              conversion_rate:
                type: number
        high_priority_alerts:
          type: array
          items:
            type: object
            properties:
              alert_type:
                type: string
              message:
                type: string
              lead_id:
                type: string
              created_at:
                type: string
                format: date-time

    PeriodMetrics:
      type: object
      properties:
        leads_count:
          type: integer
        conversions_count:
          type: integer
        conversion_rate:
          type: number
          format: percentage
        revenue:
          type: number
        average_lead_score:
          type: number

    ConversionFunnelResponse:
      type: object
      properties:
        funnel_stages:
          type: array
          items:
            type: object
            properties:
              stage:
                type: string
                enum: [new, contacted, qualified, converted]
              count:
                type: integer
              percentage:
                type: number
              conversion_rate_to_next:
                type: number
        time_series:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              stage_counts:
                type: object

    ResponseTimeAnalytics:
      type: object
      properties:
        overall_metrics:
          type: object
          properties:
            average_response_minutes:
              type: number
            median_response_minutes:
              type: number
            under_5_minutes_count:
              type: integer
            under_5_minutes_rate:
              type: number
        daily_breakdown:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              average_response_minutes:
                type: number
              leads_count:
                type: integer
              under_5_minutes_rate:
                type: number
        hourly_patterns:
          type: array
          items:
            type: object
            properties:
              hour:
                type: integer
              average_response_minutes:
                type: number
              lead_volume:
                type: integer

    AutomationPerformanceResponse:
      type: object
      properties:
        email_performance:
          type: object
          properties:
            total_sent:
              type: integer
            delivery_rate:
              type: number
            open_rate:
              type: number
            click_rate:
              type: number
            response_rate:
              type: number
        template_performance:
          type: array
          items:
            type: object
            properties:
              template_name:
                type: string
              sent_count:
                type: integer
              engagement_metrics:
                type: object
        conversion_attribution:
          type: object
          properties:
            automated_conversions:
              type: integer
            manual_conversions:
              type: integer
            automation_contribution_rate:
              type: number

    RevenuePipelineResponse:
      type: object
      properties:
        pipeline_value:
          type: object
          properties:
            total:
              type: number
            by_stage:
              type: object
              properties:
                new:
                  type: number
                contacted:
                  type: number
                qualified:
                  type: number
        revenue_trends:
          type: array
          items:
            type: object
            properties:
              month:
                type: string
              revenue:
                type: number
              lead_count:
                type: integer
              average_deal_size:
                type: number
        service_type_breakdown:
          type: array
          items:
            type: object
            properties:
              service_type:
                type: string
              revenue:
                type: number
              count:
                type: integer
              average_value:
                type: number

    # Integration Schemas
    IntegrationStatusResponse:
      type: object
      properties:
        integrations:
          type: array
          items:
            type: object
            properties:
              service_name:
                type: string
              status:
                type: string
                enum: [healthy, warning, error, disabled]
              last_sync:
                type: string
                format: date-time
              error_message:
                type: string
              performance_metrics:
                type: object

    IntegrationSyncRequest:
      type: object
      required: [service_name]
      properties:
        service_name:
          type: string
          enum: [zoho_crm, fasttrack_invision, all]
        sync_type:
          type: string
          enum: [full, incremental]
          default: incremental
        force:
          type: boolean
          default: false
          description: Force sync even if recent sync exists

    IntegrationSyncResponse:
      type: object
      properties:
        sync_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [started, completed, failed]
        records_processed:
          type: integer
        errors:
          type: array
          items:
            type: string

    # Webhook Schemas
    WebhookFormSubmission:
      allOf:
        - $ref: '#/components/schemas/LeadCreateRequest'
        - type: object
          properties:
            form_id:
              type: string
              description: Website form identifier
            page_url:
              type: string
              format: uri
              description: URL where form was submitted
            user_agent:
              type: string
              description: Browser user agent string
            ip_address:
              type: string
              format: ip
              description: Visitor IP address

    WebhookProcessingResponse:
      type: object
      properties:
        processing_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [processed, queued, failed]
        lead_created:
          type: boolean
        actions_taken:
          type: array
          items:
            type: string
        estimated_response_time:
          type: string

    EmailEngagementWebhook:
      type: object
      required: [event_type, message_id, email]
      properties:
        event_type:
          type: string
          enum: [delivered, opened, clicked, bounced, complained, unsubscribed]
        message_id:
          type: string
          description: Email message identifier
        email:
          type: string
          format: email
        timestamp:
          type: string
          format: date-time
        url:
          type: string
          format: uri
          description: Clicked URL (for click events)
        user_agent:
          type: string
          description: Recipient user agent (for engagement events)

    CRMUpdateWebhook:
      type: object
      required: [event_type, record_id]
      properties:
        event_type:
          type: string
          enum: [lead_created, lead_updated, deal_closed, contact_updated]
        record_id:
          type: string
          description: CRM record identifier
        external_id:
          type: string
          description: TNT system lead ID (if available)
        data:
          type: object
          description: Updated record data
        timestamp:
          type: string
          format: date-time

    # Utility Schemas
    PaginationInfo:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total_pages:
          type: integer
        total_count:
          type: integer
        has_next:
          type: boolean
        has_previous:
          type: boolean

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: array
              items:
                type: string
            timestamp:
              type: string
              format: date-time
            request_id:
              type: string
              format: uuid

  responses:
    BadRequest:
      description: Bad request - validation errors or malformed input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: "VALIDATION_ERROR"
              message: "Request validation failed"
              details:
                - "email field is required"
                - "estimated_value must be a positive number"
              timestamp: "2024-03-15T10:30:00Z"
              request_id: "550e8400-e29b-41d4-a716-446655440001"

    Unauthorized:
      description: Unauthorized - invalid or missing authentication
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: "UNAUTHORIZED"
              message: "Invalid or expired authentication token"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: "RESOURCE_NOT_FOUND"
              message: "Lead with specified ID not found"

    RateLimited:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: "RATE_LIMIT_EXCEEDED"
              message: "Too many requests. Please try again in 60 seconds"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: "INTERNAL_SERVER_ERROR"
              message: "An unexpected error occurred"

# =====================================================
# API DOCUMENTATION TAGS
# =====================================================

tags:
  - name: Lead Management
    description: |
      Core lead capture, scoring, and management functionality.
      Handles the primary business logic for TNT's lead automation system.
  - name: Automation
    description: |
      Email automation, template management, and workflow triggers.
      Implements the 5-minute response time requirement through automated sequences.
  - name: Analytics
    description: |
      Performance tracking, conversion analysis, and business intelligence.
      Provides insights for optimizing lead conversion and revenue growth.
  - name: Integrations
    description: |
      External system connections and synchronization.
      Manages data flow with FastTrack InVision, Zoho CRM, and email providers.
  - name: Webhooks
    description: |
      Event-driven endpoints for real-time data processing.
      Handles form submissions, email engagement, and CRM updates.